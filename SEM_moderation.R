library(lavaan)
library(semTools)
library(ezCutoffs)


mydata <- Erhebung

# Fit testen (noch ohne Interaktion)

# Messmodell (step 1)

test_model <- '
# Ladungen
SWEV =~ SV1 + SV2 + SV3 + SV4 + SV5
Flow =~ F1 + F2  + F4 + F5 + F6 + F7 + F8 + F9 + F3
SWEN =~ SN1 + SN2 + SN3 + SN4 + SN5
'

test_fit <- cfa(test_model, data = mydata, estimator="MLM")

summary(test_fit, fit.measures = TRUE, standardized=TRUE)

mi <- modificationindices(test_fit)
mi[mi$mi>10,]

# Strukturmodell (step 2; hier nicht nötig, da saturiert)

test_model2 <- '
# Ladungen
SWEV =~ SV1 + SV2 + SV3 + SV4 + SV5
Flow =~ F1 + F2  + F4 + F5 + F6 + F7 + F8 + F9 + F3
SWEN =~ SN1 + SN2 + SN3 + SN4 + SN5

SWEN ~ SWEV + Flow
'

test_fit2 <- sem(test_model2, data = mydata, estimator="MLM")

summary(test_fit2, fit.measures = TRUE, standardized=TRUE)

mi <- modificationindices(test_fit)
mi[mi$mi>10,]

# Double Mean Centering

mydata_dmc <- indProd (mydata , var1 = c("SV1", "SV2", "SV3", "SV4", "SV5" ),
                       var2 = c("F1", "F2", "F4", "F5", "F6", "F7", "F8", "F9", "F3"),
                       match = FALSE , meanC = TRUE ,
                       residualC = FALSE , doubleMC = TRUE)

head(mydata_dmc)

# Modellschätzung mit latenter Interaktion

int_model <- '
# Ladungen
SWEV =~ SV1 + SV2 + SV3 + SV4 + SV5
Flow =~ F1 + F2  + F4 + F5 + F6 + F7 + F8 + F9 + F3
SWEN =~ SN1 + SN2 + SN3 + SN4 + SN5
int =~ SV1.F1 + SV1.F2 + SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6+ SV1.F7+ SV1.F8+ SV1.F9 +
SV2.F1 + SV2.F2 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6+ SV2.F7+ SV2.F8+ SV2.F9 +
SV3.F1 + SV3.F2 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6+ SV3.F7+ SV3.F8+ SV3.F9 +
SV4.F1 + SV4.F2 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6+ SV4.F7+ SV4.F8+ SV4.F9 +
SV5.F1 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6+ SV5.F7+ SV5.F8+ SV5.F9

# Regression
SWEN ~ SWEV + Flow + int

# Fehlerkovarianzen
SV1.F1 ~~ SV1.F2 + SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F1 + SV2.F2 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F1 + SV3.F2 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F1 + SV4.F2 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F1 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV2.F1 ~~ SV1.F2 + SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F2 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F1 + SV3.F2 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F1 + SV4.F2 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F1 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV3.F1 ~~ SV1.F2 + SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F2 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F2 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F1 + SV4.F2 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F1 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV4.F1 ~~ SV1.F2 + SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F2 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F2 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F2 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F1 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV5.F1 ~~ SV1.F2 + SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F2 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F2 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F2 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV1.F2 ~~ SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F2 + SV3.F2 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F2 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV2.F2 ~~ SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F2 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F2 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV3.F2 ~~ SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F2 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV4.F2 ~~ SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F2 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV5.F2 ~~ SV1.F3 + SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV1.F3 ~~ SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F3 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV2.F3 ~~ SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F3 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV3.F3 ~~ SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F3 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV4.F3 ~~ SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F3 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV5.F3 ~~ SV1.F4 + SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV1.F4 ~~ SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F4 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV2.F4 ~~ SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F4 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV3.F4 ~~ SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F4 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV4.F4 ~~ SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F4 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV5.F4 ~~ SV1.F5 + SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV1.F5 ~~ SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F5 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV2.F5 ~~ SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F5 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV3.F5 ~~ SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F5 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV4.F5 ~~ SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F5 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV5.F5 ~~ SV1.F6 + SV1.F7 + SV1.F8 + SV1.F9 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV1.F6 ~~ SV1.F7 + SV1.F8 + SV1.F9 + SV2.F6 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV2.F6 ~~ SV1.F7 + SV1.F8 + SV1.F9 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F6 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV3.F6 ~~ SV1.F7 + SV1.F8 + SV1.F9 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F6 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV4.F6 ~~ SV1.F7 + SV1.F8 + SV1.F9 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F6 + SV5.F7 + SV5.F8 + SV5.F9
SV5.F6 ~~ SV1.F7 + SV1.F8 + SV1.F9 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F7 + SV5.F8 + SV5.F9
SV1.F7 ~~ SV1.F8 + SV1.F9 + SV2.F7 + SV2.F8 + SV2.F9 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F7 + SV5.F8 + SV5.F9
SV2.F7 ~~ SV1.F8 + SV1.F9 + SV2.F8 + SV2.F9 + SV3.F7 + SV3.F8 + SV3.F9 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F7 + SV5.F8 + SV5.F9
SV3.F7 ~~ SV1.F8 + SV1.F9 + SV2.F8 + SV2.F9 + SV3.F8 + SV3.F9 + SV4.F7 + SV4.F8 + SV4.F9 + SV5.F7 + SV5.F8 + SV5.F9
SV4.F7 ~~ SV1.F8 + SV1.F9 + SV2.F8 + SV2.F9 + SV3.F8 + SV3.F9 + SV4.F8 + SV4.F9 + SV5.F7 + SV5.F8 + SV5.F9
SV5.F7 ~~ SV1.F8 + SV1.F9 + SV2.F8 + SV2.F9 + SV3.F8 + SV3.F9 + SV4.F8 + SV4.F9 + SV5.F8 + SV5.F9
SV1.F8 ~~ SV1.F9 + SV2.F8 + SV2.F9 + SV3.F8 + SV3.F9 + SV4.F8 + SV4.F9 + SV5.F8 + SV5.F9
SV2.F8 ~~ SV1.F9 + SV2.F9 + SV3.F8 + SV3.F9 + SV4.F8 + SV4.F9 + SV5.F8 + SV5.F9
SV3.F8 ~~ SV1.F9 + SV2.F9 + SV3.F9 + SV4.F8 + SV4.F9 + SV5.F8 + SV5.F9
SV4.F8 ~~ SV1.F9 + SV2.F9 + SV3.F9 + SV4.F9 + SV5.F8 + SV5.F9
SV5.F8 ~~ SV1.F9 + SV2.F9 + SV3.F9 + SV4.F9 + SV5.F9
SV1.F9 ~~ SV2.F9 + SV3.F9 + SV4.F9 + SV5.F9
SV2.F9 ~~ SV3.F9 + SV4.F9 + SV5.F9
SV3.F9 ~~ SV4.F9 + SV5.F9
SV4.F9 ~~ SV5.F9



'

int_fit <- sem(int_model, data = mydata_dmc, estimator="MLM")

summary(int_fit, fit.measures = TRUE, standardized=TRUE)

mi <- modindices(int_fit)
mi[mi$mi > 10,]

# Simple Slopes

probe <- probe2WayMC(int_fit, c("SWEV", "Flow", "int"), "SWEN", "Flow",
                     c(-sqrt(1.462),0, sqrt(1.462)))
probe

plotProbe(probe, c(-3,3))
